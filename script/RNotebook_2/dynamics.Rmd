---
title: 'Dynamics Analysis: The Sound of Teaching Music 1'
output:
  html_notebook: default
editor_options: 
  chunk_output_type: inline
---

Description: This is a summary of all analyses for dynamics.

- Last checked: `r format(Sys.Date(), "%d-%b-%Y")`

# Outline - Dynamics (Key Velocity)
## [Experimental Design](#design)

## [Dynamics](#vel-dynamics)

### KV
- Individual results
  + [All](#vel_dyn_ind_all)
  + [Trial by trial](#vel_dyn_ind_trial)

- Group results and stats (if available)
  + [All](#vel_dyn_group_all)
  + [Trial by trial](#vel_dyn_group_trial)
  
- Order analysis (teaching/performing first?)
  + [All](#vel_dyn_order_group_all)

### KV-Diff
- Individual results
  + [All](#vel_acc_dyn_ind_all)
  + [Trial by trial](#vel_acc_dyn_ind_trial)

- Group results and stats (if available)
  + [All](#vel_acc_dyn_group_all)
  + [Trial by trial](#vel_acc_dyn_group_trial)

- Order analysis (teaching/performing first?)
  + [All](#vel_acc_dyn_order_group_all)
  
- [Sequence plot](#sequence_dyn)

## [Articulation](#vel_articulation)

### KV
- Individual results
  + [All](#vel_art_ind_all)
  + [Trial by trial](#vel_art_ind_trial)

- Group results and stats (if available)
  + [All](#vel_art_group_all)
  + [Trial by trial](#vel_art_group_trial)

### KV-Diff
- Individual results
  + [All](#vel_acc_art_ind_all)
  + [Trial by trial](#vel_acc_art_ind_trial)

- Group results and stats (if available)
  + [All](#vel_acc_art_group_all)
  + [Trial by trial](#vel_acc_art_group_trial)

- [Sequence plot](#sequence_art)

## Experimental Design{#design}
- Independent variables: Condition (2 levels: teaching vs. performing) x Subcomponent (2 levels: forte vs. piano / legato vs. staccato)
- Dependent variables: Key Velocity (KV), KV difference

## Main predictions
Participants will exaggerate forte and piano more while teaching.

## Excluded participnats
- SubNr 1: Most of responses (more than 90%) were removed due to outliers
- SubNr 3: Experimental error
- SubNr 8: Experimental error
- SubNr 14: Experimental error

```{r setup, include = FALSE}
# packages
# data manipulation
if (!require("data.table")) {install.packages("data.table"); require("data.table")}
# plot
if (!require("ggplot2")) {install.packages("ggplot2"); require("ggplot2")}
if (!require("ggsignif")) {install.packages("ggsignif"); require("ggsignif")}
# statistics
if (!require("stats")) {install.packages("stats"); require("stats")}
if (!require("effsize")) {install.packages("effsize"); require("effsize")}
if (!require("ez")) {install.packages("ez"); require("ez")}

# ggplots
theme_set(theme_classic())
theme_update(text = element_text(size = 20, family = "Helvetica Neue LT Std 57 Condensed"), legend.position = "bottom")
```

```{r file, include = FALSE}
filename_vel = "../R/preprocessor/trimmed/data_vel.txt"
filename_vel_acc = "../R/preprocessor/trimmed/data_vel_diff.txt"
```

```{r extract, include = FALSE}
dt_vel <- fread(filename_vel, header = T, sep = ",", dec = ".") # read a trimmed txt
dt_vel_acc <- fread(filename_vel_acc, header = T, sep = ",", dec = ".") # read a trimmed txt

# SubNr as a factor
dt_vel$SubNr <- as.factor(dt_vel$SubNr)
dt_vel_acc$SubNr <- as.factor(dt_vel_acc$SubNr)

# Exclude SubNr 1 because most responses were removed because of outliers
dt_vel <- dt_vel[SubNr != 1]
dt_vel_acc <- dt_vel_acc[SubNr != 1]

# Include only articulation
dt_vel_art <- dt_vel[Skill == "articulation"]
dt_vel_acc_art <- dt_vel_acc[Skill == "articulation"]

# Include only dynamics
dt_vel_dyn <- dt_vel[Skill == "dynamics"]
dt_vel_acc_dyn <- dt_vel_acc[Skill == "dynamics"]
```

# Key Velocity (KV) - Dynamics
## 1. All - individual{#vel_dyn_ind_all}
- Average KV for each participant.

```{r vel_dyn, echo = FALSE}
# For each individual
vel_dyn <- dt_vel_dyn[, .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, Condition, Skill, Subcomponent)]
vel_dyn
```

### Plot
#### Bar chart
- Error bars show SD of the mean

```{r vel_dyn_bar,  echo = FALSE}
p_vel_dyn <- ggplot(data = vel_dyn, aes(x = SubNr, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                width = .2, position = position_dodge(.9)) +
  facet_grid(Subcomponent ~ .) +
  labs(y = "KV (0-127)", subtitle = "KV: Dynamics") + coord_cartesian(ylim = c(40, 100))
p_vel_dyn
```

## 2. All - group{#vel_dyn_group_all}
- Average KV for each condition.
- Hypothesis: Participants will exaggerate forte and piano when teaching.

```{r vel_dyn_all, echo = FALSE}
# Group mean
vel_dyn_all <- vel_dyn[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent)]
vel_dyn_all
```

### Plot
#### Bar chart
- Error bars show SEM of the mean

```{r vel_dyn_all_bar, echo = FALSE}　
p_vel_dyn_all <- ggplot(data = vel_dyn_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM),
                width = .2, position = position_dodge(.9)) +
  labs(y = "KV (0-127)", subtitle = "KV: Dynamics") + coord_cartesian(ylim = c(40, 100))
p_vel_dyn_all
```

#### Box plot
```{r vel_dyn_all_box, echo = FALSE}
p_vel_dyn_all_box <- ggplot(data = vel_dyn, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_boxplot() +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, position = position_dodge(0.75)) +
  labs(y = "KV (0-127)", subtitle = "KV: Dynamics")
p_vel_dyn_all_box
```

### Statistics
#### Normality check
```{r normality1, echo = FALSE}
# Reduce unused factors
vel_dyn$Subcomponent <- factor(vel_dyn$Subcomponent)
vel_dyn_norm <- by(vel_dyn$Mean, list(vel_dyn$Condition, vel_dyn$Subcomponent), shapiro.test)
print(vel_dyn_norm)
```

#### Two-way ANOVA (ez)
```{r stats1, echo = FALSE}
vel_dyn_aov <- ezANOVA(
  data = dt_vel_dyn
  , dv = .(Velocity)
  , wid = .(SubNr)
  , within = .(Condition, Subcomponent)
  , type = 3
  , detailed = TRUE
)
vel_dyn_aov$ANOVA$F <- round(vel_dyn_aov$ANOVA$F, 4)
vel_dyn_aov$ANOVA$p <- round(vel_dyn_aov$ANOVA$p, 4)
vel_dyn_aov$ANOVA
```

#### Two-way ANOVA (aov)
```{r stats2, echo = FALSE}
vel_dyn_aov_2 <- aov(Mean ~ Condition*Subcomponent + Error(SubNr/(Condition*Subcomponent)), data = vel_dyn)
summary(vel_dyn_aov_2)
```

#### Post-hoc (direct comparison)
```{r post-hoc1, echo = FALSE}
vel_ttest_forte <- t.test(vel_dyn[Condition == "performing" & Subcomponent == "Forte"]$Mean, vel_dyn[Condition == "teaching" & Subcomponent == "Forte"]$Mean, paired = TRUE)
vel_ttest_piano <- t.test(vel_dyn[Condition == "performing" & Subcomponent == "Piano"]$Mean, vel_dyn[Condition == "teaching" & Subcomponent == "Piano"]$Mean, paired = TRUE)
# # Effect size
# vel_ttest_forte_cohend <- cohen.d(vel_dyn$Mean[vel_dyn$Subcomponent == "Forte"], vel_dyn$Condition[vel_dyn$Subcomponent == "Forte"], paired = TRUE)
# vel_ttest_piano_cohend <- cohen.d(vel_dyn$Mean[vel_dyn$Subcomponent == "Piano"], vel_dyn$Condition[vel_dyn$Subcomponent == "Piano"], paired = TRUE)

vel_ttest_forte
vel_ttest_piano
# vel_ttest_forte_cohend
# vel_ttest_piano_cohend
```

#### Post-hoc (pairwise t test)
```{r post-hoc2, echo = FALSE}
# Create a group label for a post-hoc test
vel_dyn$Group <- "NA"
vel_dyn[Condition == "performing" & Subcomponent == "Forte"]$Group <- "Performing-Forte" 
vel_dyn[Condition == "performing" & Subcomponent == "Piano"]$Group <- "Performing-Piano"
vel_dyn[Condition == "teaching" & Subcomponent == "Forte"]$Group <- "Teaching-Forte"
vel_dyn[Condition == "teaching" & Subcomponent == "Piano"]$Group <- "Teaching-Piano"
# pairwise comparison
vel_dyn_pairwise <- pairwise.t.test(vel_dyn$Mean, vel_dyn$Group, paired = TRUE, p.adjust.method = "BH")
vel_dyn_pairwise$p.value <- round(vel_dyn_pairwise$p.value, 4)
vel_dyn_pairwise
```

## 3. Trial by trial - individual{#vel_dyn_ind_trial}
- Average KV for each trial for each participant.

```{r vel_dyn_trial, echo = FALSE}
# For each individual
vel_dyn_trial <- dt_vel_dyn[, .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, Condition, Skill, Subcomponent, TrialNr)]
vel_dyn_trial
```

### Plot
#### Line graph
```{r vel_dyn_trial_line_forte, echo = FALSE, fig.height = 4}
p_vel_dyn_trial_forte <- ggplot(data = vel_dyn_trial[Subcomponent == "Forte"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Dynamics/Forte") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_dyn_trial_forte
```

```{r vel_dyn_trial_line_piano, echo = FALSE, fig.height = 4}
p_vel_dyn_trial_piano <- ggplot(data = vel_dyn_trial[Subcomponent == "Piano"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Dynamics/Piano") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_dyn_trial_piano
```

## 4. Trial by trial - group{#vel_dyn_group_trial}
- Average KV for each trial for each condition.

```{r vel_dyn_trial_all, echo = FALSE}
# Group mean
vel_dyn_trial_all <- vel_dyn_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent, TrialNr)]
vel_dyn_trial_all
```

### Plot
#### Line graph
- Error bars show SEM of the mean

```{r vel_dyn_trial_all_line_forte, echo = FALSE}
p_vel_dyn_trial_all_forte <- ggplot(data = vel_dyn_trial_all[Subcomponent == "Forte"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Dynamics/Forte") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_dyn_trial_all_forte
```

```{r vel_dyn_trial_all_line_piano, echo = FALSE}
p_vel_dyn_trial_all_piano <- ggplot(data = vel_dyn_trial_all[Subcomponent == "Piano"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Dynamics/Piano") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_dyn_trial_all_piano
```

# Key Velocity Difference (Difference) - Dynamics
## 1. All - individual{#vel_acc_dyn_ind_all}
- Average KV-Diff for each participant.

```{r vel_acc_dyn, echo = FALSE}
# For each individual
vel_acc_dyn <- dt_vel_acc_dyn[Subcomponent == "FtoP" | Subcomponent == "PtoF", .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(SubNr, Condition, Skill, Subcomponent)]
vel_acc_dyn
```

### Plot
#### Bar chart
- Error bars show SD of the mean

```{r vel_acc_dyn_bar,  echo = FALSE}
p_vel_acc_dyn <- ggplot(data = vel_acc_dyn, aes(x = SubNr, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                width = .2, position = position_dodge(.9)) +
  facet_grid(Subcomponent ~ .) +
  labs(y = "Difference", subtitle = "KV-Diff: Dynamics")
p_vel_acc_dyn
```

## 2. All - group{#vel_acc_dyn_group_all}
- Average KV-Diff for each condition.

```{r vel_acc_dyn_all, echo = FALSE}
# Group mean
vel_acc_dyn_all <- vel_acc_dyn[, .(N = .N, Mean = mean(Mean), SD = mean(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent)]
vel_acc_dyn_all
```

### Plot
#### Bar chart
```{r vel_acc_dyn_all_bar,  echo = FALSE}
p_vel_acc_dyn_all <- ggplot(data = vel_acc_dyn_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM),
                width = .2, position = position_dodge(.9)) +
  labs(y = "Difference", subtitle = "KV-Diff: Dynamics")
p_vel_acc_dyn_all
```

#### Box plot
```{r vel_acc_dyn_all_box, echo = FALSE}
p_vel_acc_dyn_all_box <- ggplot(data = vel_acc_dyn, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_boxplot() +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, position = position_dodge(0.75)) +
  labs(y = "Difference", subtitle = "KV-Diff: Dynamics")
p_vel_acc_dyn_all_box
```

### Statistics
#### Normality check
```{r normality2, echo = FALSE}
# Reduce unused factors
vel_acc_dyn$Subcomponent <- factor(vel_acc_dyn$Subcomponent)
vel_acc_dyn_norm <- by(vel_acc_dyn$Mean, list(vel_acc_dyn$Condition, vel_acc_dyn$Subcomponent), shapiro.test)
vel_acc_dyn_norm
```

#### Two-way ANOVA (ez)
```{r stats3, echo = FALSE}
vel_acc_dyn_aov <- ezANOVA(
  data = dt_vel_acc_dyn[Subcomponent == "FtoP" | Subcomponent == "PtoF"]
  , dv = .(Diff)
  , wid = .(SubNr)
  , within = .(Condition, Subcomponent)
  , type = 3
  , detailed = TRUE
)
vel_acc_dyn_aov$ANOVA$F <- round(vel_acc_dyn_aov$ANOVA$F, 4)
vel_acc_dyn_aov$ANOVA$p <- round(vel_acc_dyn_aov$ANOVA$p, 4)
vel_acc_dyn_aov$ANOVA
```

#### Two-way ANOVA (aov)
```{r stats4, echo = FALSE}
vel_acc_dyn_aov_2 <- aov(Mean ~ Condition*Subcomponent + Error(SubNr/(Condition*Subcomponent)), vel_acc_dyn)
summary(vel_acc_dyn_aov_2)
```

#### Post-hoc (direct comparison)
```{r post-hoc3, echo = FALSE}
vel_acc_ttest_ftop <- t.test(vel_acc_dyn[Condition == "performing" & Subcomponent == "FtoP"]$Mean, vel_acc_dyn[Condition == "teaching" & Subcomponent == "FtoP"]$Mean, paired = TRUE)
vel_acc_ttest_ptof <- t.test(vel_acc_dyn[Condition == "performing" & Subcomponent == "PtoF"]$Mean, vel_acc_dyn[Condition == "teaching" & Subcomponent == "PtoF"]$Mean, paired = TRUE)
# # Effect size
# vel_acc_ttest_ftop_cohend <- cohen.d(vel_acc_dyn$Mean[vel_acc_dyn$Subcomponent == "FtoP"], vel_acc_dyn$Condition[vel_acc_dyn$Subcomponent == "FtoP"], paired = TRUE)
# vel_acc_ttest_ptof_cohend <- cohen.d(vel_acc_dyn$Mean[vel_acc_dyn$Subcomponent == "PtoF"], vel_acc_dyn$Condition[vel_acc_dyn$Subcomponent == "PtoF"], paired = TRUE)

vel_acc_ttest_ftop
vel_acc_ttest_ptof
# vel_acc_ttest_ftop_cohend
# vel_acc_ttest_ptof_cohend
```

#### Post-hoc (pairwise t test)
```{r post-hoc4, echo = FALSE}
# Create a group label for a post-hoc test
vel_acc_dyn$Group <- "NA"
vel_acc_dyn[Condition == "performing" & Subcomponent == "FtoP"]$Group <- "Performing-FtoP" 
vel_acc_dyn[Condition == "performing" & Subcomponent == "PtoF"]$Group <- "Performing-PtoF"
vel_acc_dyn[Condition == "teaching" & Subcomponent == "FtoP"]$Group <- "Teaching-FtoP"
vel_acc_dyn[Condition == "teaching" & Subcomponent == "PtoF"]$Group <- "Teaching-PtoF"
# pairwise comparison
vel_acc_dyn_pairwise <- pairwise.t.test(vel_acc_dyn$Mean, vel_acc_dyn$Group, paired = TRUE, p.adjust.method = "BH")
vel_acc_dyn_pairwise$p.value <- round(vel_acc_dyn_pairwise$p.value, 4)
vel_acc_dyn_pairwise
```

## 3. Trial by trial - individual{#vel_acc_dyn_ind_trial}
- Average KV-Diff for each trial for each participant.

```{r vel_acc_dyn_trial, echo = FALSE}
# For each individual
vel_acc_dyn_trial <- dt_vel_acc_dyn[Subcomponent == "FtoP" | Subcomponent == "PtoF", .(N = .N, Mean = mean(Diff), SD = mean(Diff)), by = .(SubNr, Condition, Skill, Subcomponent,TrialNr)]
vel_acc_dyn_trial
```

### Plot
#### Line graph
```{r vel_acc_dyn_trial_line_ftop, echo = FALSE, fig.height = 4}
p_vel_acc_dyn_trial_ftop <- ggplot(data = vel_acc_dyn_trial[Subcomponent == "FtoP"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Dynamics/Forte to Piano") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_dyn_trial_ftop
```

```{r vel_acc_dyn_trial_line_ptof, echo = FALSE, fig.height = 4}
p_vel_acc_dyn_trial_ptof <- ggplot(data = vel_acc_dyn_trial[Subcomponent == "PtoF"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Dynamics/Piano to Forte") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_dyn_trial_ptof
```

## 4. Trial by trial - group{#vel_acc_dyn_group_trial}
- Average KV-Diff for each trial for each condition.

```{r vel_acc_dyn_trial_all, echo = FALSE}
# Group mean
vel_acc_dyn_trial_all <- vel_acc_dyn_trial[, .(N = .N, Mean = mean(Mean), SD = mean(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent, TrialNr)]
vel_acc_dyn_trial_all
```

### Plot
#### Line graph
- Error bars show SEM of the mean

```{r vel_acc_dyn_trial_all_line_ftop, echo = FALSE}
p_vel_acc_dyn_trial_all_ftop <- ggplot(data = vel_acc_dyn_trial_all[Subcomponent == "FtoP"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Dynamics/Forte to Piano") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_dyn_trial_all_ftop
```

```{r vel_acc_dyn_trial_all_line_ptof, echo = FALSE}
p_vel_acc_dyn_trial_all_ptof <- ggplot(data = vel_acc_dyn_trial_all[Subcomponent == "PtoF"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Dynamics/Piano to Forte") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_dyn_trial_all_ptof
```

# Key Velocity (KV) - Articulation
## 1. All - individual{#vel_art_ind_all}
- Average KV for each participant.

```{r vel_art, echo = FALSE}
# For each individual
vel_art <- dt_vel_art[, .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, Condition, Skill, Subcomponent)]
vel_art
```

### Plot
#### Bar chart
- Error bars show SD of the mean

```{r vel_art_bar,  echo = FALSE}
p_vel_art <- ggplot(data = vel_art, aes(x = SubNr, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                width = .2, position = position_dodge(.9)) +
  facet_grid(Subcomponent ~ .) +
  labs(y = "KV (0-127)", subtitle = "KV: Articulation") + coord_cartesian(ylim = c(40, 100))
p_vel_art
```

## 2. All - group{#vel_art_group_all}
- Average KV for each condition.

```{r vel_art_all, echo = FALSE}
# Group mean
vel_art_all <- vel_art[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent)]
vel_art_all
```

### Plot
#### Bar chart
- Error bars show SEM of the mean

```{r vel_art_all_bar, echo = FALSE}　
p_vel_art_all <- ggplot(data = vel_art_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM),
                width = .2, position = position_dodge(.9)) +
  labs(y = "KV (0-127)", subtitle = "KV: Articulation") + coord_cartesian(ylim = c(40, 100))
p_vel_art_all
```

#### Box plot
```{r vel_art_all_box, echo = FALSE}
p_vel_art_all_box <- ggplot(data = vel_art, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_boxplot() +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, position = position_dodge(0.75)) +
  labs(y = "KV (0-127)", subtitle = "KV: Articulation")
p_vel_art_all_box
```

### Statistics
#### Normality check
```{r normality3, echo = FALSE}
# Reduce unused factors
vel_art$Subcomponent <- factor(vel_art$Subcomponent)
vel_art_norm <- by(vel_art$Mean, list(vel_art$Condition, vel_art$Subcomponent), shapiro.test)
vel_art_norm
```

#### Two-way ANOVA (ez)
```{r stats5, echo = FALSE}
vel_art_aov <- ezANOVA(
  data = dt_vel_art
  , dv = .(Velocity)
  , wid = .(SubNr)
  , within = .(Condition, Subcomponent)
  , type = 3
  , detailed = TRUE
)
vel_art_aov$ANOVA$F <- round(vel_art_aov$ANOVA$F, 4)
vel_art_aov$ANOVA$p <- round(vel_art_aov$ANOVA$p, 4)
vel_art_aov$ANOVA
```

#### Two-way ANOVA (aov)
```{r stats6, echo = FALSE}
vel_art_aov_2 <- aov(Mean ~ Condition*Subcomponent + Error(SubNr/(Condition*Subcomponent)), data = vel_art)
summary(vel_art_aov_2)
```

#### Post-hoc (direct comparison)
```{r post-hoc5, echo = FALSE}
vel_ttest_legato <- t.test(vel_art[Condition == "performing" & Subcomponent == "Legato"]$Mean, vel_art[Condition == "teaching" & Subcomponent == "Legato"]$Mean, paired = TRUE)
vel_ttest_staccato <- t.test(vel_art[Condition == "performing" & Subcomponent == "Staccato"]$Mean, vel_art[Condition == "teaching" & Subcomponent == "Staccato"]$Mean, paired = TRUE)
# # Effect size
# vel_ttest_legato_cohend <- cohen.d(vel_art$Mean[vel_art$Subcomponent == "Legato"], vel_art$Condition[vel_art$Subcomponent == "Legato"], paired = TRUE)
# vel_ttest_staccato_cohend <- cohen.d(vel_art$Mean[vel_art$Subcomponent == "Staccato"], vel_art$Condition[vel_art$Subcomponent == "Staccato"], paired = TRUE)

vel_ttest_legato
vel_ttest_staccato
# vel_ttest_legato_cohend
# vel_ttest_staccato_cohend
```

#### Post-hoc (pairwise t test)
```{r post-hoc6, echo = FALSE}
# Create a group label for a post-hoc test
vel_art$Group <- "NA"
vel_art[Condition == "performing" & Subcomponent == "Legato"]$Group <- "Performing-Legato" 
vel_art[Condition == "performing" & Subcomponent == "Staccato"]$Group <- "Performing-Staccato"
vel_art[Condition == "teaching" & Subcomponent == "Legato"]$Group <- "Teaching-Legato"
vel_art[Condition == "teaching" & Subcomponent == "Staccato"]$Group <- "Teaching-Staccato"
# pairwise comparison
vel_art_pairwise <- pairwise.t.test(vel_art$Mean, vel_art$Group, paired = TRUE, p.adjust.method = "BH")
vel_art_pairwise$p.value <- round(vel_art_pairwise$p.value, 4)
vel_art_pairwise
```

## 3. Trial by trial - individual{#vel_art_ind_trial}
- Average KV for each trial for each participant.

```{r vel_art_trial, echo = FALSE}
# For each individual
vel_art_trial <- dt_vel_art[, .(N = .N, Mean = mean(Velocity), SD = sd(Velocity)), by = .(SubNr, Condition, Skill, Subcomponent, TrialNr)]
vel_art_trial
```

### Plot
#### Line graph
```{r vel_art_trial_line_legato, echo = FALSE, fig.height = 4}
p_vel_art_trial_legato <- ggplot(data = vel_art_trial[Subcomponent == "Legato"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Articulation/Legato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_art_trial_legato
```

```{r vel_art_trial_line_piano, echo = FALSE, fig.height = 4}
p_vel_art_trial_staccato <- ggplot(data = vel_art_trial[Subcomponent == "Staccato"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Articulation/Staccato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_art_trial_staccato
```

## 4. Trial by trial - group{#vel_art_group_trial}
- Average KV for each trial for each condition.

```{r vel_art_trial_all, echo = FALSE}
# Group mean
vel_art_trial_all <- vel_art_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent, TrialNr)]
vel_art_trial_all
```

### Plot
#### Line graph
- Error bars show SEM of the mean

```{r vel_art_trial_all_line_legato, echo = FALSE}
p_vel_art_trial_all_legato <- ggplot(data = vel_art_trial_all[Subcomponent == "Legato"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Articulation/Legato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_art_trial_all_legato
```

```{r vel_art_trial_all_line_staccato, echo = FALSE}
p_vel_art_trial_all_staccato <- ggplot(data = vel_art_trial_all[Subcomponent == "Staccato"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "KV (0-127)", subtitle = "KV: Articulation/Staccato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_art_trial_all_staccato
```

# Key Velocity Difference (Difference) - Articulation
## 1. All - individual{#vel_acc_art_ind_all}
- Average KV-Diff for each participant.

```{r vel_acc_art, echo = FALSE}
# For each individual
vel_acc_art <- dt_vel_acc_art[Subcomponent == "LtoS" | Subcomponent == "StoL", .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(SubNr, Condition, Skill, Subcomponent)]
vel_acc_art
```

### Plot
#### Bar chart
- Error bars show SD of the mean

```{r vel_acc_art_bar,  echo = FALSE}
p_vel_acc_art <- ggplot(data = vel_acc_art, aes(x = SubNr, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SD, ymax = Mean + SD),
                width = .2, position = position_dodge(.9)) +
  facet_grid(Subcomponent ~ .) +
  labs(y = "Difference", subtitle = "KV-Diff: Articulaion")
p_vel_acc_art
```

## 2. All - group{#vel_acc_art_group_all}
- Average KV-Diff for each condition.

```{r vel_acc_art_all, echo = FALSE}
# Group mean
vel_acc_art_all <- vel_acc_art[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent)]
vel_acc_art_all
```

### Plot
#### Bar chart
```{r vel_acc_art_all_bar,  echo = FALSE}
p_vel_acc_art_all <- ggplot(data = vel_acc_art_all, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM),
                width = .2, position = position_dodge(.9)) +
  labs(y = "Difference", subtitle = "KV-Diff: Articulation")
p_vel_acc_art_all
```

#### Box plot
```{r vel_acc_art_all_box, echo = FALSE}
p_vel_acc_art_all_box <- ggplot(data = vel_acc_art, aes(x = Subcomponent, y = Mean, fill = Condition)) +
  geom_boxplot() +
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, position = position_dodge(0.75)) +
  labs(y = "Difference", subtitle = "KV-Diff: Articulation")
p_vel_acc_art_all_box
```

### Statistics
#### Normality check
- Violate the normality
```{r normality4, echo = FALSE}
# Reduce unused factors
vel_acc_art$Subcomponent <- factor(vel_acc_art$Subcomponent)
vel_acc_art_norm <- by(vel_acc_art$Mean, list(vel_acc_art$Condition, vel_acc_art$Subcomponent), shapiro.test)
vel_acc_art_norm
```

#### Two-way ANOVA (ez)
```{r stats7, echo = FALSE}
vel_acc_art_aov <- ezANOVA(
  data = dt_vel_acc_art[Subcomponent == "LtoS" | Subcomponent == "StoL"]
  , dv = .(Diff)
  , wid = .(SubNr)
  , within = .(Condition, Subcomponent)
  , type = 3
  , detailed = TRUE
)
vel_acc_art_aov$ANOVA$F <- round(vel_acc_art_aov$ANOVA$F, 4)
vel_acc_art_aov$ANOVA$p <- round(vel_acc_art_aov$ANOVA$p, 4)
print(vel_acc_art_aov$ANOVA)
```

#### Post-hoc (direct comparison)
```{r post-hoc7, echo = FALSE}
vel_acc_ttest_ltos <- t.test(vel_acc_art[Condition == "performing" & Subcomponent == "LtoS"]$Mean, vel_acc_art[Condition == "teaching" & Subcomponent == "LtoS"]$Mean, paired = TRUE)
vel_acc_ttest_stol <- t.test(vel_acc_art[Condition == "performing" & Subcomponent == "StoL"]$Mean, vel_acc_art[Condition == "teaching" & Subcomponent == "StoL"]$Mean, paired = TRUE)
# # Effect size
# vel_acc_ttest_ltos_cohend <- cohen.d(vel_acc_art$Mean[vel_acc_art$Subcomponent == "LtoS"], vel_acc_art$Condition[vel_acc_art$Subcomponent == "LtoS"], paired = TRUE)
# vel_acc_ttest_stol_cohend <- cohen.d(vel_acc_art$Mean[vel_acc_art$Subcomponent == "StoL"], vel_acc_art$Condition[vel_acc_art$Subcomponent == "StoL"], paired = TRUE)

vel_acc_ttest_ltos
vel_acc_ttest_stol
# vel_acc_ttest_ltos_cohend
# vel_acc_ttest_stol_cohend
```

#### Post-hoc (pairwise t test)
```{r post-hoc8, echo = FALSE}
# Create a group label for a post-hoc test
vel_acc_art$Group <- "NA"
vel_acc_art[Condition == "performing" & Subcomponent == "LtoS"]$Group <- "Performing-LtoS" 
vel_acc_art[Condition == "performing" & Subcomponent == "StoL"]$Group <- "Performing-StoL"
vel_acc_art[Condition == "teaching" & Subcomponent == "LtoS"]$Group <- "Teaching-LtoS"
vel_acc_art[Condition == "teaching" & Subcomponent == "StoL"]$Group <- "Teaching-StoL"
# pairwise comparison
vel_acc_art_pairwise <- pairwise.t.test(vel_acc_art$Mean, vel_acc_art$Group, paired = TRUE, p.adjust.method = "BH")
vel_acc_art_pairwise$p.value <- round(vel_acc_art_pairwise$p.value, 4)
vel_acc_art_pairwise
```

#### Two-way ANOVA (aov)
```{r stats8, echo = FALSE}
vel_acc_art_aov_2 <- aov(Mean ~ Condition*Subcomponent + Error(SubNr/(Condition*Subcomponent)), data = vel_acc_art)
summary(vel_acc_art_aov_2)
```

## 3. Trial by trial - individual{#vel_acc_art_ind_trial}
- Average KV-Diff for each trial for each participant.

```{r vel_acc_art_trial, echo = FALSE}
# For each individual
vel_acc_art_trial <- dt_vel_acc_art[, .(N = .N, Mean = mean(Diff), SD = sd(Diff)), by = .(SubNr, Condition, Skill, Subcomponent, TrialNr)]
vel_acc_art_trial
```

### Plot
#### Line graph
```{r vel_acc_art_trial_line_ltos, echo = FALSE, fig.height = 4}
p_vel_acc_art_trial_ltos <- ggplot(data = vel_acc_art_trial[Subcomponent == "LtoS"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Articulation/Legato to Staccato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_art_trial_ltos
```

```{r vel_acc_art_trial_line_stol, echo = FALSE, fig.height = 4}
p_vel_acc_art_trial_stol <- ggplot(data = vel_acc_art_trial[Subcomponent == "StoL"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line() +
  geom_point() +
  facet_wrap(SubNr ~ .) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Articulation/Staccato to Legato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_art_trial_stol
```

## 4. Trial by trial - group{#vel_acc_art_group_trial}
- Average KV-Diff for each trial for each condition.

```{r vel_acc_art_trial_all, echo = FALSE}
# Group mean
vel_acc_art_trial_all <- vel_acc_art_trial[, .(N = .N, Mean = mean(Mean), SD = sd(Mean), SEM = sd(Mean)/sqrt(.N)), by = .(Condition, Skill, Subcomponent, TrialNr)]
vel_acc_art_trial_all
```

### Plot
#### Line graph
- Error bars show SEM of the mean

```{r vel_acc_art_trial_all_line_ltos, echo = FALSE}
p_vel_acc_art_trial_all_ltos <- ggplot(data = vel_acc_art_trial_all[Subcomponent == "LtoS"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Articulation/Legato to Staccato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_art_trial_all_ltos
```

```{r vel_acc_art_trial_all_line_stol, echo = FALSE}
p_vel_acc_art_trial_all_stol <- ggplot(data = vel_acc_art_trial_all[Subcomponent == "StoL"], aes(x = TrialNr, y = Mean, group = Condition, colour = Condition)) +
  geom_line(position = position_dodge(.2)) +
  geom_point(position = position_dodge(.2)) +
  geom_errorbar(aes(ymin = Mean - SEM, ymax = Mean + SEM), width = .2, position = position_dodge(.2)) + 
  labs(x = "Trial", y = "Difference", subtitle = "KV-Diff: Articulation/Legato to Staccato") + scale_x_continuous(breaks=seq(1,8,1))
p_vel_acc_art_trial_all_stol
```
